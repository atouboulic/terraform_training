# TP 08 - Terraform state & terraform import
## Préparation

Créer un nouveau projet TP08 avec backend consul

## Objectif du tp

L'objectif est de ce TP est d'importer une resource existante et de la gérer avec Terraform.
Ensuite on va déplacer cette resource avec terraform sous un autre label et modifier le tfstate avec la commande state

## Import legacy

Se positionner dans le répertoire TP08

Créer un block pour gérer la resource docker_network = tp_terraform_network.

Importer la resource tp_terraform_network via la commande terraform import. (cf doc de la resource docker_network sur le registry)

Faire un terraform plan et voir si la resource va être détruite, modifiée ou créée.

Contacter le formateur pour vérification

## Import solution moderne

Créer un nouveau docker network manuellement :

```shell
docker network create --subnet 172.40.10.0/24 --ip-range 172.40.10.0/24 --gateway 172.40.10.1 tp08_terraform_network
```

Se positionner dans le répertoire TP08

Créer un block pour gérer la resource docker_network = tp08_terraform_network.

Importer la resource tp08_terraform_network via un block import. 

Faire un terraform plan et voir si la resource va être détruite, modifiée ou créée.

Contacter le formateur pour vérification

## Ajouter un output nommé "my_networks" qui affiche le contenu des 2 networks maintenant gérés par terraform

## Migrer une resource dans le tfstate.

Dans le même projet, renommer le label de la resource docker_network tp_terraform_network.
Faire un terraform plan et voir ce qu'il se passe.

Normalement la resource doit être supprimée et recréee. Mais on ne veux surtout pas cela !

Pour éviter cela, on va déplacer la resource avec terraform state pour ne pas que la resource soit détruite.
Faire la commande state ???? pour lister resources existantes
Faire la commande state ???? qui permet de déplacer un resource

Faire la commande terraform plan et vérifier qu'aucun changement n'a lieu.

